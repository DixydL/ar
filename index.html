<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image.prod.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-aframe.prod.js"></script>
    <script
        src="https://rawgit.com/allanweir/aframe-touch-rotation-controls/master/dist/aframe-touch-rotation-controls.min.js"></script>
</head>

<body>
    <a-scene mindar-image="imageTargetSrc: /targets.mind;" color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        <a-assets>
            <a-asset-item id="bearModel" src="/r/scene.gltf"></a-asset-item>
        </a-assets>

        <a-camera universal-controls="movementControls: hmd; rotationControls: touch-rotation"></a-camera>

        <a-entity camera mindar-image-target="targetIndex: 0" look-controls>
            <a-gltf-model rotation="1 0 0 " position="0 0 0" scale="0.5 0.5 0.5" src="#bearModel" animation-mixer>
        </a-entity>
    </a-scene>
</body>
<script>

    AFRAME.registerComponent('drag-rotate-component', {
        schema: { speed: { default: 1 } },
        init: function () {
            this.ifMouseDown = false;
            this.x_cord = 0;
            this.y_cord = 0;
            // document.addEventListener('mousedown', this.OnDocumentMouseDown.bind(this));
            // document.addEventListener('mouseup', this.OnDocumentMouseUp.bind(this));
            // document.addEventListener('mousemove', this.OnDocumentMouseMove.bind(this));
            document.addEventListener("touchstart", this.OnDocumentMouseDown.bind(this));
            document.addEventListener("touchend", this.OnDocumentMouseUp.bind(this));
            // document.addEventListener("touchcancel", this.OnDocumentMouseMove.bind(this));
            document.addEventListener("touchmove", this.OnDocumentMouseMove.bind(this));
        },
        OnDocumentMouseDown: function (event) {
            this.ifMouseDown = true;
            this.x_cord = event.clientX;
            this.y_cord = event.clientY;
        },
        OnDocumentMouseUp: function () {
            this.ifMouseDown = false;
        },
        OnDocumentMouseMove: function (event) {
            console.log("xz");
            if (this.ifMouseDown) {

                var touch = event.touches[0];
                var movementX = touch.screenX - this.x_cord;
                var movementY = touch.screenY - this.y_cord;
                console.log(movementX);

                if (Math.abs(movementY) < Math.abs(movementX)) {
                    el.object3D.rotation.set(
                        THREE.Math.degToRad(movementX * this.data.speed / 1000),
                        THREE.Math.degToRad(0),
                        THREE.Math.degToRad(0)
                    );
                    el.object3D.rotation.x += Math.PI;
                }
                else {
                    el.object3D.rotation.set(
                        THREE.Math.degToRad(0),
                        THREE.Math.degToRad(movementY * this.data.speed / 1000),
                        THREE.Math.degToRad(0)
                    );
                    el.object3D.rotation.y += Math.PI;
                }
                this.x_cord = touch.screenX;
                this.y_cord = touch.screenY;
            }
        }
    });
    // var intervalId = window.setInterval(function () {
    //     el.object3D.scale.x += 1;
    //     el.object3D.scale.y += 1;
    //     el.object3D.scale.z += 1;
    // }, 200);
</script>

</html>